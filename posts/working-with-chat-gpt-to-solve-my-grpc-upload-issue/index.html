<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ChatGpt] Flutter file upload gRPC. - wizlif</title>
    <meta name="description" content="Porompting ChatGpt to help me analyze and solve a file upload problem with Go rGPC services and Flutter gRPC.">
    <meta name="author" content="wizlif">

    <link rel="alternate" type="application/rss+xml" href="/rss.xml">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="stylesheet" href="/assets/asset.afd67771.css" /><script type="module" src="/entry.71b34318.js"></script>
</head>
  <body class="bg-slate-900 text-gray-100">
    <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-20 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2128 700" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><g id="layer1" fill="#FFFFFF" stroke="none"><path d="M309.7 250.4C308 253.4 307.3 341.1 307.3 517.5 307.3 774.5 307.3 780.1 311.8 782.5 318 785.8 440.9 785.8 447 782.5 452.2 779.7 453 771.2 448.7 765.2 445.9 761.7 438.8 761.2 388.9 760.8L332.2 760 332.2 515.4 332.2 270.7 1061.5 270.7 1790.8 270.7 1790.8 515.4 1790.8 760 1726 760.8C1683 761 1660 762.2 1657.9 763.8 1654.1 767.1 1653.9 778.3 1657.7 782 1661.5 785.8 1804.3 786.1 1810.9 782.5 1815.4 780.1 1815.4 773.3 1815.4 517.3 1815.4 347.5 1814.7 253.2 1813 250.4 1810.9 246.1 1789.8 245.9 1061.5 245.9 323.2 245.9 312.3 245.9 309.7 250.4ZM489.8 332.9C487.2 335.5 484.4 344.2 482.5 354.8 481.1 364.3 478.3 379.7 476.4 388.9 474.5 397.9 471.4 416.1 469.3 429.1 467.1 442.1 464.1 460 462.2 469.3 460.3 478.3 457 496.5 454.8 509.5 452.7 522.5 449.6 540.4 448 549.6 446.1 558.6 442.6 579.4 439.7 595.7 436.9 612.1 433.8 629.1 432.4 633.8 431.2 638.5 430.3 645.4 430.3 649.2 430.3 653 428.8 661.2 427 667.8 425.3 674.2 424.3 681.1 424.8 682.5 425.8 684.9 436.9 685.6 470.7 685.6 512.3 685.6 515.6 685.3 520.1 680.9 526 674.9 529.1 674.9 535.5 680.9 540.2 685.3 543.7 685.8 583.7 685.8 607.3 686.1 627.2 685.6 627.4 685.1 629.6 682.5 635.9 660 635.9 655.1 635.9 648.5 641.8 613.2 645.6 595.7 647 589.8 648.9 579.2 650.1 572.1 651.1 565 654.4 546.3 657.2 530.7 660 515.1 663.4 496.5 664.3 489.4 665.5 482.3 668.6 464.5 671.4 450.4 674.2 435.9 677.3 418 678.5 410.2 679.4 402.4 681.3 391.7 682.7 386.5 684.2 381.3 686.5 367.1 688.2 355.1 692 328.6 692 328.6 666.2 328.6 646.8 328.6 641.8 331 639.5 341.1 637.1 351.8 630.5 389.4 628.8 401.9 627.9 409 626 420.1 624.6 426.7 623.2 433.1 620.3 449.2 618.2 462.2 616.1 475.2 612.8 494.3 610.9 504.7 609 515.1 606.4 528.8 605 535.5 600.2 560.8 595.5 587.9 593.6 600.5 587.9 636.9 586.1 644.2 580.9 648.2 570 657 558.6 650.8 561.2 637.6 561.9 633.3 563.6 623.6 565 615.8 566.2 608 569.5 589.4 572.1 574.5 574.9 559.6 578 541.4 579.2 534.3 580.4 527.2 583.5 509 586.3 494.1 589.1 479.2 592.2 460.3 593.4 452.2 594.3 444.2 596 436.4 596.9 434.8 597.9 433.3 599.5 425.5 600.7 417.5 604.3 388.4 609.9 355.6 612.3 350.4 615.6 342.6 615.1 334.3 611.3 331.2 609.2 329.3 600.5 328.6 587.2 329.1L566.7 329.8 562.4 342.8C560 349.9 557.9 359.1 557.9 363.1 557.9 367.1 556.5 377.8 554.6 386.8 548.7 416.1 545.4 433.6 543.5 445.6 542.6 452 539.5 469.7 536.9 484.6 534 499.5 530.7 518.2 529.8 526 528.6 533.8 526.5 544.9 525.3 550.8 523.9 556.7 521 572.6 518.9 586.3 512.3 627.4 508.3 644 503.1 648.2 496.9 653.7 491 653.7 486.5 648.2 483.2 644.7 483.2 641.1 488.4 611.1 491.3 592.9 495 572.6 496.5 566.2 497.9 559.6 500 548.5 500.9 541.4 505 514.7 510.4 483.2 512.8 472.8 514.2 466.9 516.8 452 518.9 439.7 525.3 400.5 529.8 375.2 533.3 359.1 539.2 330.7 537.8 328.6 510.9 328.6 497.9 328.6 493.1 329.6 489.8 332.9ZM805.7 332.6C803.5 335 800.9 342.8 800.2 349.9 799.3 357 797.4 367.1 796.2 372.3 794.8 377.5 792.9 387 792 393.6 785.1 435.5 782.5 451.3 780.4 460.8 779.2 466.7 776.4 481.1 774.5 492.9 766.4 540.9 763.1 559.8 760 575.7 758.2 584.6 754.8 602.8 752.7 615.8 750.8 628.8 747.5 646.6 745.4 655.1 743.5 663.8 742.3 674 742.8 677.5 743.5 684.2 743.7 684.4 761.2 685.6 788.4 687.7 789.6 687 794.6 667.8 796.9 658.6 799.1 648.5 799.1 644.9 799.1 641.4 800.2 633.8 801.4 628.4 803.8 618.7 809.2 588.9 813.2 563.8 814.2 557.2 817.5 539.2 820.3 523.6 823.2 508 826.2 489.4 827.4 482.3 828.4 475.2 830.5 464.5 831.9 458.6 833.1 452.7 835.9 436.9 838.1 423.2 840.2 409.5 843.5 391.5 845.2 383 851.3 354.8 854.1 333.3 852.5 331.4 851.5 330.5 841.4 329.3 830.3 329.1 812.5 328.4 809 328.8 805.7 332.6ZM966.9 333.3C963.8 336.4 962.2 341.1 962.2 347 962.2 352.2 960.5 361.5 958.6 367.8 956.7 374.2 955.1 384.4 955.1 390.5 955.1 403.1 959.1 408.3 974.5 416.3 991 424.8 994.3 422 997.6 396.2 1000.7 371.2 1008.5 361.2 1021.3 365.2 1028.4 367.4 1027.4 380.1 1018.7 399.1 1014.7 407.8 1009.9 418.4 1008 422.5 1006.1 426.7 1003.3 433.8 1001.4 437.8 999.5 442.1 995.5 451.5 992.2 458.6 988.9 465.7 981.8 482.3 976.4 495 970.9 507.8 965.7 520.1 964.5 522.2 963.4 524.3 957 539.2 950.4 555.6 939.2 582 935 592.2 922.9 618.7 909.2 649.9 905.9 659.1 904.5 671.9 903.8 678 904.3 683.7 905.4 684.4 909.5 687 1019.1 685.8 1022.5 683.2 1026.7 679.7 1029.1 659.6 1025.5 655.6 1023.4 653 1016.5 652.2 995.5 652.5 980.4 652.7 966.7 652.7 965.2 652.7 960.3 652.5 961.7 644.2 969 628.4 972.6 620.1 983.9 593.9 993.9 569.7 1004 545.6 1013 524.3 1014.2 522.2 1015.1 520.3 1027 493.1 1040.2 461.9 1053.4 431 1065.2 404.5 1066.4 403.1 1067.6 401.9 1068.6 399.5 1068.6 397.9 1068.6 396.2 1071.6 388.2 1075.4 380.1 1079.2 371.9 1082.7 360.5 1083.5 354.6 1084.4 348.7 1085.6 342.1 1086.3 340 1087 338.1 1086.1 334.5 1083.9 332.4 1080.6 329.1 1072.8 328.6 1025.8 328.6 974.7 328.6 971.4 328.8 966.9 333.3ZM1203.3 330.3C1198.1 332.4 1196.2 335.9 1196.2 344.2 1196.2 348.2 1194.6 356.3 1192.7 361.7 1190.8 367.1 1189.1 374.7 1189.1 378.5 1189.1 384.9 1185.6 406.4 1179.7 435 1178.3 442.1 1176.1 453.9 1174.9 461 1174 468.1 1170.9 486.3 1168.1 501.2 1165.2 516.1 1161.9 535.7 1160.8 544.4 1159.6 553.4 1157.9 561.2 1157.4 562.2 1157 563.1 1154.1 578.3 1151.3 595.7 1148.7 613.2 1144.9 634 1143 641.8 1138.3 662.6 1136.4 682.5 1139.2 684.2 1143.5 687 1249.9 686.1 1255.1 683.2 1258.9 681.3 1260 678.3 1260 671.6 1260 666.7 1261.7 657.9 1263.6 652.5 1265.5 647 1267.1 636.4 1267.1 629.1 1267.1 617.5 1266.2 614.7 1260.8 609.2 1254.4 603.3 1239.5 595.7 1234 595.7 1230.5 595.7 1226.7 606.6 1224.6 623.9 1222 643 1216.3 651.3 1205.4 651.3L1197.4 651.3 1197.6 635.9C1197.6 627.4 1200 608.3 1202.8 593.4 1205.7 578.5 1208.5 561.9 1209.2 556.7 1209.9 551.5 1212.1 539.7 1213.9 530.7 1215.8 521.5 1219.1 503.5 1221.3 490.5 1223.2 477.5 1226.5 460 1228.1 451.5 1230 443 1233.1 425.5 1235.2 412.5 1237.1 399.5 1240.4 381.3 1242.3 372.3 1247.5 347.3 1248.5 334.5 1245.4 331.4 1242.6 328.6 1210.2 327.7 1203.3 330.3ZM1436.4 330.7C1431.7 332.6 1428.4 344.2 1423.2 375.9 1422 383 1418.7 401.7 1415.8 417.3 1413 432.9 1409.9 450.8 1409 457.4 1407.8 463.8 1404.7 481.6 1401.9 496.5 1399.1 511.3 1395.7 529.6 1394.8 536.6 1393.9 543.7 1392 554.4 1390.5 560.3 1389.1 566.2 1386.3 582 1384.2 595.7 1382 609.5 1379 627.9 1377.1 637.1 1370.4 670.7 1368.6 683.5 1370 685.6 1371.9 688.9 1401.4 704 1409 705.7L1415.6 707.1 1419.6 683.9C1421.7 671.2 1424.8 653.9 1426.7 645.4 1428.4 636.9 1431.7 619.4 1433.8 606.4 1435.7 593.4 1439 574.7 1440.9 565 1442.8 555.3 1444.7 544 1445.4 540.2 1445.9 536.2 1448.7 520.3 1451.5 504.7 1454.4 489.1 1457.4 470.4 1458.6 463.4 1459.6 456.3 1461.7 445.6 1463.1 439.7 1464.3 433.8 1467.1 418 1469.3 404.3 1471.4 390.5 1474.7 373.3 1476.6 366 1481.1 347.5 1481.1 331.9 1476.1 330 1470.9 328.1 1441.8 328.6 1436.4 330.7ZM1595 330.3C1593.1 333.6 1586.8 365 1582.7 390.1 1580.6 403.8 1577.3 421.7 1575.7 430.3 1573.8 438.8 1570.7 456.3 1568.6 469.3 1566.4 482.3 1563.4 500.2 1561.5 509.5 1559.6 518.4 1556.5 536.2 1554.4 548.5 1549.2 580.1 1544 609 1541.1 624.1 1538.1 640.2 1532.2 676.4 1531.9 680.1 1531.9 684.6 1541.1 686.5 1560.3 685.8 1572.3 685.3 1579 684.2 1580.6 681.8 1583 679 1588.2 652.5 1592.4 622.9 1593.1 618.9 1595 607.8 1596.9 598.1 1598.8 588.4 1601.9 569.7 1604 556.7 1606.1 543.7 1609.2 526.5 1611.1 518.4 1613 510.4 1614.7 500.7 1614.7 496.9 1614.7 479.4 1637.6 471.6 1646.8 485.8 1648.9 489.1 1652 491.7 1653.7 491.7 1658.4 491.7 1664.3 474.9 1665 459.8L1665.5 445.6 1647.8 444.9C1626.5 444 1624.1 442.6 1626.7 430.7 1627.9 426 1630.5 411.3 1632.6 398.3 1636.9 372.8 1641.8 364.1 1651.8 364.1 1654.8 364.1 1658.6 366.4 1661 369.7 1664.3 375.2 1664.3 376.8 1661 390.1 1658.9 398.1 1657.2 408.3 1657.2 412.8 1657.2 422.9 1661.5 423.2 1679.7 414.7 1695.3 407.1 1703.8 397.9 1705.7 385.8 1706.4 381.1 1708 371.2 1709.5 364.1 1714.4 340.4 1714.7 332.9 1711.3 330.7 1707.3 328.1 1596.5 327.9 1595 330.3ZM712.3 739.2C704.5 740.7 705.7 746.3 713.9 748.2 720.1 749.6 721.3 751.1 722.5 759.1 723.9 766.9 724.8 768.6 729.1 767.8 733.3 767.1 734.3 765.2 734.8 755.6 735.2 749.2 734.8 743.3 733.6 742.3 731 739.7 718.4 738.1 712.3 739.2ZM515.8 772.3L516.5 805 536.2 805.7C552.5 806.1 555.8 805.7 557.2 802.4 559.3 796.9 553.4 793.9 543.3 795.3 528.4 796.9 526.2 793.4 524.8 765.5 523.9 744.7 522.9 741.1 519.4 740.4 515.6 739.7 515.4 742.1 515.8 772.3ZM1125.3 771.6C1125.3 801.7 1125.5 803.8 1129.8 803.8 1135.2 803.8 1137.1 799.3 1137.1 786.3 1137.1 774.5 1143 767.4 1151.8 768.8 1156.7 769.5 1157.2 770.9 1158.4 785.3 1159.6 802.4 1161 805.2 1166.7 802.8 1170 801.7 1170.4 798.8 1169 783 1166.9 760.3 1164.1 756.5 1149.2 757.2 1138.5 757.7 1138.3 757.7 1137.1 749.4 1136.2 743 1134.8 740.9 1130.7 740.4 1125.3 739.7 1125.3 739.7 1125.3 771.6ZM1369.7 743C1369.3 744.7 1369 758.9 1369.3 774.5L1370 802.6 1383 804.3C1400.2 806.4 1405.7 804.7 1411.3 795.5 1417.7 785.1 1417.5 773.5 1410.4 765 1406.1 759.6 1402.4 757.7 1393.4 756.7 1382.3 755.3 1381.8 754.8 1381.1 747.5 1380.4 741.8 1379.2 740 1375.7 740 1373 740 1370.4 741.4 1369.7 743ZM1400.7 781.3C1400.7 792 1400.2 793.1 1395.3 793.9 1388.4 794.8 1380.6 788.2 1380.6 781.8 1380.6 774.5 1387.7 768.1 1394.6 768.8 1400.2 769.5 1400.7 770.4 1400.7 781.3ZM647 748.2C642.1 753 639.5 765.7 642.8 769 644.2 770.4 645.4 777.1 645.4 783.7 645.4 800.5 649.2 805 663.8 805 677.3 805 678.3 804.5 679 796.5 679.7 791.7 678.7 790.8 673.8 791.5 670.4 791.7 665.7 792.4 663.1 792.7 659.1 793.1 658.4 791.5 657.7 780.6 657 768.6 657 768.3 663.6 768.3 678.7 768.1 680.4 757.9 665.7 755.3 660.5 754.1 656.7 752 656 749.2 654.1 743.7 651.5 743.5 647 748.2ZM1011.8 749.2C1011.8 751.5 1010.2 754.8 1008.3 756.5 1006.4 758.2 1004.7 761 1004.7 762.9 1004.7 764.5 1006.4 766.7 1008.3 767.4 1010.9 768.6 1011.8 772.6 1011.8 783.5 1011.8 791.7 1013 799.3 1014.7 800.9 1018.4 804.7 1040.7 804.7 1044.4 800.9 1048.9 796.5 1048 789.6 1042.8 789.6 1040.2 789.6 1037.4 790.5 1036.6 792 1035.9 793.1 1032.6 794.3 1029.6 794.3 1025.1 794.3 1023.6 792.7 1022.5 786.3 1019.9 773.3 1021.5 769.7 1030.7 768.3 1041.4 766.9 1042.3 758.9 1032.2 756.3 1028.6 755.3 1023.9 752.2 1022 749.6 1017.7 743.5 1011.8 743.3 1011.8 749.2ZM1499.1 751.1C1496.2 758.6 1499.1 797.9 1502.8 801.7 1504.3 803.1 1509.5 804.7 1514.4 805.4 1521.5 806.4 1525.1 805.4 1530.3 801.4 1533.8 798.6 1536.6 795.3 1536.6 794.1 1536.6 790.1 1529.3 788.9 1523.6 792 1514.7 796.9 1510.6 793.6 1510.6 781.3 1510.6 771.4 1511.3 770.2 1517.7 768.1 1525.3 765.2 1527.9 756.5 1521.3 756.5 1519.1 756.5 1514.9 753.9 1511.6 750.6 1504 743 1502.4 743.3 1499.1 751.1ZM1261.5 757.2C1254.6 762.2 1258.2 768.3 1268.1 768.3 1272.6 768.3 1276.8 769.3 1277.5 770.4 1279.2 773 1271.2 775.4 1260.8 775.4 1255.8 775.4 1252 777.1 1249.6 780.6 1244.2 788.2 1244.9 793.6 1252 800.7 1257.7 806.4 1259.1 806.6 1272.6 805 1280.6 804.3 1287.9 802.1 1288.9 800.7 1291.5 796.7 1291.3 768.8 1288.4 763.8 1287.2 761.5 1283.2 758.9 1279.7 758.2 1276.1 757.4 1271.4 756.3 1269.5 755.3 1267.4 754.6 1263.8 755.6 1261.5 757.2ZM1276.1 788.7C1275.2 793.4 1266.7 796.9 1262.4 794.3 1257 791 1261.7 784.9 1269.5 784.9 1275.2 784.9 1276.8 785.8 1276.1 788.7ZM586.1 759.1C579 761.7 576.8 766.9 576.8 782.7 576.8 797.9 581.8 803.5 597.2 805.2 609.5 806.9 621.7 802.8 618 799.1 616.8 797.9 610.6 796.7 604 796.2 588.4 795.3 588.9 791 605 789.6 616.5 788.7 618 787.7 620.1 781.8 625.8 764.1 606.9 751.5 586.1 759.1ZM607.6 771.9C607.6 776.6 602.1 778.7 594.6 776.8 584.6 774.2 587.2 768.3 598.1 768.3 605 768.3 607.6 769.3 607.6 771.9ZM765.2 760.8C757.7 769.3 762.2 776.4 780.9 785.8 785.8 788.4 789.4 791.5 788.9 792.9 788.4 794.3 782.3 795.5 775.4 795.5 761.7 795.5 757.4 799.3 766 803.8 769.3 805.7 776.1 805.9 784.9 805 796.5 803.5 798.8 802.4 801.2 797.4 805 789.4 799.3 780.9 787 775.9 775.7 771.4 777.3 768.3 791 768.3 801.7 768.3 804.5 765.2 798.6 759.3 793.9 754.6 769.7 755.8 765.2 760.8ZM898.3 758.2C896.5 758.9 892 762.2 888.4 765.5 874.2 778.7 883 802.8 903.1 805.4 914.4 807.1 924.3 804.7 924.3 800.5 924.3 796.9 917.3 794.3 907.6 794.3 901.2 794.3 891.3 786.8 891.3 781.8 891.3 774 898.6 768.3 908.5 768.3 920.3 768.3 925.5 765.5 923.6 760.3 922.2 756.5 906.6 755.1 898.3 758.2ZM955.3 761C952.2 766.4 954.1 768.3 961.9 768.3 965.2 768.3 969.5 769.3 971.4 770.4 974.7 772.6 969.7 774 952.7 775.9 949.4 776.4 945.6 779.2 943.3 783 940.2 788.9 940.2 790.3 943.3 796 947.5 803.5 957.9 806.4 974.5 804.5L985.8 803.1 985.8 784.6C985.8 769 985.1 765.2 981.1 761.2 974.7 754.8 958.6 754.6 955.3 761ZM974 786.8C974 790.8 968.1 794.3 961.7 794.3 956.7 794.3 955.1 793.1 955.1 789.6 955.1 785.6 956.7 784.9 964.5 784.9 969.7 784.9 974 785.8 974 786.8ZM1079 758.9C1064.3 764.8 1059.6 784.2 1069.7 796.2 1076.6 804.5 1085.6 807.1 1098.1 804.7 1109.2 802.6 1107.6 798.6 1094.1 795.5 1081.3 792.7 1075.7 788.4 1075.7 781.6 1075.7 773.3 1079.2 770.2 1091 768.1 1104.3 765.7 1105.2 765 1103.3 760 1101.7 756 1087.5 755.3 1079 758.9ZM1465.7 759.3C1465.7 761 1464.3 765.2 1462.4 768.6 1460.8 771.9 1458.6 777.5 1457.7 780.9 1456.5 786.3 1455.6 787 1451.5 784.9 1448.9 783.5 1445.9 778.3 1444.4 773.3 1441.8 763.4 1436.6 757.4 1432.6 760 1428.6 762.6 1430 770 1437.6 786.1 1445.9 803.5 1445.9 811.6 1437.8 812.8 1433.8 813.5 1432.6 814.9 1433.1 818.7 1434 825.8 1444.9 827 1450.8 820.6 1458.2 812.5 1475.4 769 1473.8 762.4 1472.3 756.5 1465.7 754.1 1465.7 759.3ZM1557 763.6C1551.8 770 1551.3 772.3 1552.5 783.2 1553.2 790.3 1555.6 797.4 1558.2 800 1563.4 805.7 1586.8 808.3 1592.2 803.8 1597.4 799.5 1594.3 796.7 1583.9 796.7 1579 796.7 1573.3 796 1571.2 795.3 1564.3 792.7 1570 789.6 1581.6 789.6 1592 789.6 1593.1 789.1 1595.5 782.5 1599.1 772.1 1594.8 762.2 1585.8 759.1 1572.6 754.4 1563.6 755.8 1557 763.6ZM1584.6 770C1587.7 772.8 1581.1 777.8 1574.2 777.8 1567.4 777.8 1563.8 774.7 1566.2 770.7 1567.8 768.1 1582.3 767.4 1584.6 770Z"></path></g></svg></div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/wizlif">GitHub</a></li><li class="hover:text-white"><a href="https://twitter.com/wizlif144">Twitter</a></li></ul></nav></div></div>

    <div class="mx-auto max-w-screen-lg px-3 py-6"><h1 class="text-center text-3xl font-bold">[ChatGpt] Flutter file upload gRPC.</h1><div class="mt-2 text-center text-sm text-gray-400">By <!-- -->wizlif<!-- --> on<!-- --> <!-- -->Apr 17, 2023</div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-w-3 aspect-h-2"><img class="h-full w-full rounded-lg object-cover object-center" src="/assets/images/blogs/06.webp" alt="Image post 2" loading="lazy"/></div><div class="prose prose-invert mt-8 prose-img:rounded-lg"><h3 id="-assume-i-have-an-application-eco-system-from-flutter-communicating-with-a-grpc-backend-storing-info-in-postgresql-database-how-can-i-implement-file-upload-with-resume-capability-to-an-aws-s3-backend">>> Assume i have an application eco-system from Flutter communicating with a gRPC backend storing info in postgresql database. How can i implement file upload with resume capability to an AWS S3 backend.</h3><p>To implement file upload with resume capability to an AWS S3 backend in your Flutter application communicating with a gRPC backend storing info in PostgreSQL database, you can follow the following steps:</p><ol>
<li>
<p>Install the necessary packages: First, you need to install the <code>grpc</code> and <code>grpc_tools</code> packages for gRPC, and the <code>postgres</code> and <code>aws-sdk-s3</code> packages for PostgreSQL and AWS S3, respectively.</p>
</li>
<li>
<p>Create a gRPC service: Create a gRPC service that defines a method for uploading files. The method should take the file data, file name, and file size as input parameters, and return a URL that can be used to download the uploaded file.</p>
</li>
<li>
<p>Implement file upload with resume capability: Implement the file upload functionality in your Flutter application using the <code>dio</code> package. Use the <code>multipart</code> request type to upload the file data in chunks. You can use the <code>Range</code> header to resume the upload if it gets interrupted.</p>
</li>
<li>
<p>Store file data in PostgreSQL: Store the uploaded file data in PostgreSQL by inserting a new row into the database table. The row should contain the file name, file size, and the URL returned by the gRPC service.</p>
</li>
<li>
<p>Upload the file to AWS S3: After storing the file data in PostgreSQL, upload the file to AWS S3 using the <code>aws-sdk-s3</code> package. Use the same file name that you stored in PostgreSQL as the S3 object key.</p>
</li>
<li>
<p>Update the URL in PostgreSQL: After uploading the file to S3, update the URL stored in PostgreSQL with the S3 object URL. This URL can then be used to download the file from S3.</p>
</li>
<li>
<p>Implement file download: Implement file download functionality in your Flutter application using the <code>dio</code> package. You can use the URL stored in PostgreSQL to download the file from S3.</p>
</li>
<li>
<p>Implement file deletion: Implement file deletion functionality in your Flutter application by deleting the corresponding row from PostgreSQL and the corresponding object from S3.</p>
</li>
</ol><p>Overall, this approach allows you to implement file upload with resume capability to an AWS S3 backend in your Flutter application communicating with a gRPC backend storing info in PostgreSQL database.
user: dio works with http but as i said i’m using a gRPC backend
assistant: You are correct that <code>dio</code> is an HTTP client and gRPC is a different protocol. In that case, you can use the <code>grpc-dart</code> package in your Flutter application to communicate with your gRPC backend.</p><p>To implement file upload with resume capability in your gRPC service, you can define a streaming RPC method that accepts <code>FileChunk</code> messages as input and returns a URL after the file is successfully uploaded. The <code>FileChunk</code> message should contain the chunk data, chunk index, and file name. You can use the chunk index to resume the upload if it gets interrupted.</p><p>Here is an example implementation of the gRPC service method:</p><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #F8F8F2">service FileService {</span></span>
<span class="line"><span style="color: #F8F8F2">  rpc UploadFile(stream FileChunk) returns (UploadFileResponse);</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">message FileChunk {</span></span>
<span class="line"><span style="color: #F8F8F2">  bytes data = 1;</span></span>
<span class="line"><span style="color: #F8F8F2">  int32 index = 2;</span></span>
<span class="line"><span style="color: #F8F8F2">  string filename = 3;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"><span style="color: #F8F8F2"></span></span>
<span class="line"><span style="color: #F8F8F2">message UploadFileResponse {</span></span>
<span class="line"><span style="color: #F8F8F2">  string url = 1;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre><p>In your Flutter application, you can use the <code>grpc-dart</code> package to create a client that communicates with the gRPC backend and streams the file data. Here is an example implementation:</p><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/grpc.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/service_api.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/client/call.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/client/call.dart&#39;</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">as</span><span style="color: #F8F8F2"> call;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/client/channel.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/client/transport/transport.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/shared/message.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/shared/message.dart&#39;</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">as</span><span style="color: #F8F8F2"> shared;</span></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> </span><span style="color: #F1FA8C">&#39;package:grpc/src/shared/streams.dart&#39;</span><span style="color: #F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">class</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileUploadClient</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">late</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">ClientChannel</span><span style="color: #F8F8F2"> channel;</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">late</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileServiceClient</span><span style="color: #F8F8F2"> stub;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">FileUploadClient</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">String</span><span style="color: #F8F8F2"> host, </span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2"> port) {</span></span>
<span class="line"><span style="color: #F8F8F2">    channel </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">ClientChannel</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">      host,</span></span>
<span class="line"><span style="color: #F8F8F2">      port</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> port,</span></span>
<span class="line"><span style="color: #F8F8F2">      options</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">ChannelOptions</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">        credentials</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">ChannelCredentials</span><span style="color: #F8F8F2">.</span><span style="color: #50FA7B">insecure</span><span style="color: #F8F8F2">(),</span></span>
<span class="line"><span style="color: #F8F8F2">      ),</span></span>
<span class="line"><span style="color: #F8F8F2">    );</span></span>
<span class="line"><span style="color: #F8F8F2">    stub </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileServiceClient</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">      channel,</span></span>
<span class="line"><span style="color: #F8F8F2">      options</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">CallOptions</span><span style="color: #F8F8F2">(timeout</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">Duration</span><span style="color: #F8F8F2">(seconds</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">30</span><span style="color: #F8F8F2">)),</span></span>
<span class="line"><span style="color: #F8F8F2">    );</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">Future</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">String</span><span style="color: #F8F8F2">&gt; </span><span style="color: #50FA7B">uploadFile</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">String</span><span style="color: #F8F8F2"> filename, </span><span style="color: #8BE9FD; font-style: italic">List</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt; data) </span><span style="color: #FF79C6">async</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> fileChunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">chunkFile</span><span style="color: #F8F8F2">(data);</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> response </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">await</span><span style="color: #F8F8F2"> stub.</span><span style="color: #50FA7B">uploadFile</span><span style="color: #F8F8F2">(fileChunks);</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> response.url;</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">Stream</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">FileChunk</span><span style="color: #F8F8F2">&gt; </span><span style="color: #50FA7B">chunkFile</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">List</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt; data, {</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2"> chunkSize </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1024</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1024</span><span style="color: #F8F8F2">}) </span><span style="color: #FF79C6">async*</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> chunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (data.length </span><span style="color: #FF79C6">/</span><span style="color: #F8F8F2"> chunkSize).</span><span style="color: #50FA7B">ceil</span><span style="color: #F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">for</span><span style="color: #F8F8F2"> (</span><span style="color: #FF79C6">var</span><span style="color: #F8F8F2"> i </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">0</span><span style="color: #F8F8F2">; i </span><span style="color: #FF79C6">&lt;</span><span style="color: #F8F8F2"> chunks; i</span><span style="color: #FF79C6">++</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> start </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> i </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> chunkSize;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> end </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (i </span><span style="color: #FF79C6">+</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">) </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> chunkSize;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> fileChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileChunk</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        ..data </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> data.</span><span style="color: #50FA7B">sublist</span><span style="color: #F8F8F2">(start, end)</span></span>
<span class="line"><span style="color: #F8F8F2">        ..index </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> i</span></span>
<span class="line"><span style="color: #F8F8F2">        ..filename </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> filename;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">yield</span><span style="color: #F8F8F2"> fileChunk;</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">void</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">close</span><span style="color: #F8F8F2">() </span><span style="color: #FF79C6">async</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">await</span><span style="color: #F8F8F2"> channel.</span><span style="color: #50FA7B">shutdown</span><span style="color: #F8F8F2">();</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre><p>In this implementation, the <code>FileUploadClient</code> class creates a client channel to communicate with the gRPC backend and uses the <code>FileServiceClient</code> stub to call the <code>UploadFile</code> method. The <code>chunkFile</code> method breaks the file data into chunks and returns a stream of <code>FileChunk</code> messages.</p><p>You can then use the <code>FileUploadClient</code> class in your Flutter application to upload files to your gRPC backend and get a URL in return. You can then use the URL to download the file from AWS S3, as described in my previous answer.</p><h3 id="-now-grpc-has-a-maximum-payload-size-of-4mb-but-aws-s3-has-a-minimum-upload-size-of-5mb-how-can-i-still-send-1mb-chunks-but-handle-the-5mb-minimum-set-by-aws-s3">>> Now gRPC has a maximum payload size of 4MB but AWS S3 has a minimum upload size of 5MB how can i still send 1MB chunks but handle the 5MB minimum set by AWS S3</h3><p>You’re right that gRPC has a maximum payload size of 4MB by default, and AWS S3 has a minimum upload size of 5MB. One way to handle this is to use gRPC streaming to send multiple 1MB chunks in a single upload session until you reach the minimum upload size required by AWS S3.</p><p>Here’s how you can modify the gRPC service and Flutter client to handle this scenario:</p><ol>
<li>In the gRPC service, define a new streaming RPC method called <code>UploadFileChunked</code>. This method will accept a stream of <code>FileChunk</code> messages and return a URL after the file is successfully uploaded. Here’s an example implementation:</li>
</ol><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #F8F8F2">service FileService {</span></span>
<span class="line"><span style="color: #F8F8F2">  rpc UploadFileChunked(stream FileChunk) returns (UploadFileResponse);</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre><ol start="2">
<li>In the Flutter client, modify the <code>FileUploadClient</code> class to use the <code>UploadFileChunked</code> method instead of <code>UploadFile</code>. Here’s an example implementation:</li>
</ol><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">class</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileUploadClient</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">Future</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">String</span><span style="color: #F8F8F2">&gt; </span><span style="color: #50FA7B">uploadFile</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">String</span><span style="color: #F8F8F2"> filename, </span><span style="color: #8BE9FD; font-style: italic">List</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt; data) </span><span style="color: #FF79C6">async</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> fileChunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">chunkFile</span><span style="color: #F8F8F2">(data);</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> response </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">await</span><span style="color: #F8F8F2"> stub.</span><span style="color: #50FA7B">uploadFileChunked</span><span style="color: #F8F8F2">(fileChunks);</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> response.url;</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">Stream</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">FileChunk</span><span style="color: #F8F8F2">&gt; </span><span style="color: #50FA7B">chunkFile</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">List</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt; data, {</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2"> chunkSize </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1024</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1024</span><span style="color: #F8F8F2">}) </span><span style="color: #FF79C6">async*</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> chunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (data.length </span><span style="color: #FF79C6">/</span><span style="color: #F8F8F2"> chunkSize).</span><span style="color: #50FA7B">ceil</span><span style="color: #F8F8F2">();</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">var</span><span style="color: #F8F8F2"> totalBytesSent </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">0</span><span style="color: #F8F8F2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">for</span><span style="color: #F8F8F2"> (</span><span style="color: #FF79C6">var</span><span style="color: #F8F8F2"> i </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">0</span><span style="color: #F8F8F2">; i </span><span style="color: #FF79C6">&lt;</span><span style="color: #F8F8F2"> chunks; i</span><span style="color: #FF79C6">++</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> start </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> i </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> chunkSize;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> end </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (i </span><span style="color: #FF79C6">+</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">) </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> chunkSize;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> isLastChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (i </span><span style="color: #FF79C6">==</span><span style="color: #F8F8F2"> chunks </span><span style="color: #FF79C6">-</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> fileChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileChunk</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        ..data </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> data.</span><span style="color: #50FA7B">sublist</span><span style="color: #F8F8F2">(start, end)</span></span>
<span class="line"><span style="color: #F8F8F2">        ..index </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> i</span></span>
<span class="line"><span style="color: #F8F8F2">        ..filename </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> filename</span></span>
<span class="line"><span style="color: #F8F8F2">        ..totalChunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> chunks</span></span>
<span class="line"><span style="color: #F8F8F2">        ..isLastChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> isLastChunk;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">yield</span><span style="color: #F8F8F2"> fileChunk;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      totalBytesSent </span><span style="color: #FF79C6">+=</span><span style="color: #F8F8F2"> fileChunk.data.length;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (totalBytesSent </span><span style="color: #FF79C6">&gt;=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">MIN_UPLOAD_SIZE</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">&amp;&amp;</span><span style="color: #F8F8F2"> isLastChunk) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">break</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">      }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre><p>In this implementation, the <code>chunkFile</code> method sends multiple 1MB chunks until it reaches the minimum upload size required by AWS S3, and sets the <code>isLastChunk</code> flag to <code>true</code> for the last chunk. The <code>UploadFileChunked</code> method in the gRPC service can then use the <code>isLastChunk</code> flag to determine when to finalize the file upload and return the URL.</p><p>With these modifications, you should be able to handle file uploads with resume capability to an AWS S3 backend using gRPC and Flutter.</p><h3 id="-how-would-i-handle-resuming-the-upload-if-it-fails-in-this-case">>> How would i handle resuming the upload if it fails in this case</h3><p>To handle resuming the upload if it fails, you can keep track of the chunks that have been successfully uploaded to S3 and resume the upload from the last successfully uploaded chunk.</p><p>Here’s how you can modify the Flutter client to handle resuming the upload:</p><ol>
<li>In the <code>FileUploadClient</code> class, add a new method called <code>getUploadStatus</code> to retrieve the upload status for a file. The upload status should include the list of successfully uploaded chunk indexes for the file.</li>
</ol><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">class</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileUploadClient</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">Future</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">List</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt;&gt; </span><span style="color: #50FA7B">getUploadStatus</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">String</span><span style="color: #F8F8F2"> filename) </span><span style="color: #FF79C6">async</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> response </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">await</span><span style="color: #F8F8F2"> stub.</span><span style="color: #50FA7B">getUploadStatus</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">FileUploadStatusRequest</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        ..filename </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> filename);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> response.chunkIndexes;</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre><ol start="2">
<li>In the <code>chunkFile</code> method, check if a chunk has already been successfully uploaded before sending it. If a chunk has already been uploaded, skip it and move on to the next chunk. If a chunk fails to upload, add its index to a list of failed chunks and resume the upload from the last successfully uploaded chunk.</li>
</ol><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">class</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileUploadClient</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #8BE9FD; font-style: italic">Stream</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">FileChunk</span><span style="color: #F8F8F2">&gt; </span><span style="color: #50FA7B">chunkFile</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD; font-style: italic">List</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt; data, {</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2"> chunkSize </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1024</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1024</span><span style="color: #F8F8F2">}) </span><span style="color: #FF79C6">async*</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> chunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (data.length </span><span style="color: #FF79C6">/</span><span style="color: #F8F8F2"> chunkSize).</span><span style="color: #50FA7B">ceil</span><span style="color: #F8F8F2">();</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">var</span><span style="color: #F8F8F2"> totalBytesSent </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">0</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">var</span><span style="color: #F8F8F2"> failedChunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #FF79C6">&gt;</span><span style="color: #F8F8F2">[];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> uploadedChunkIndexes </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">await</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">getUploadStatus</span><span style="color: #F8F8F2">(filename);</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> uploadedChunkSet </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">Set</span><span style="color: #F8F8F2">&lt;</span><span style="color: #8BE9FD; font-style: italic">int</span><span style="color: #F8F8F2">&gt;.</span><span style="color: #50FA7B">from</span><span style="color: #F8F8F2">(uploadedChunkIndexes);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">for</span><span style="color: #F8F8F2"> (</span><span style="color: #FF79C6">var</span><span style="color: #F8F8F2"> i </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">0</span><span style="color: #F8F8F2">; i </span><span style="color: #FF79C6">&lt;</span><span style="color: #F8F8F2"> chunks; i</span><span style="color: #FF79C6">++</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (uploadedChunkSet.</span><span style="color: #50FA7B">contains</span><span style="color: #F8F8F2">(i)) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">continue</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> start </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> i </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> chunkSize;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> end </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (i </span><span style="color: #FF79C6">+</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">) </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2"> chunkSize;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> isLastChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> (i </span><span style="color: #FF79C6">==</span><span style="color: #F8F8F2"> chunks </span><span style="color: #FF79C6">-</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> fileChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileChunk</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">        ..data </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> data.</span><span style="color: #50FA7B">sublist</span><span style="color: #F8F8F2">(start, end)</span></span>
<span class="line"><span style="color: #F8F8F2">        ..index </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> i</span></span>
<span class="line"><span style="color: #F8F8F2">        ..filename </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> filename</span></span>
<span class="line"><span style="color: #F8F8F2">        ..totalChunks </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> chunks</span></span>
<span class="line"><span style="color: #F8F8F2">        ..isLastChunk </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> isLastChunk;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">yield</span><span style="color: #F8F8F2"> fileChunk;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      totalBytesSent </span><span style="color: #FF79C6">+=</span><span style="color: #F8F8F2"> fileChunk.data.length;</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (totalBytesSent </span><span style="color: #FF79C6">&gt;=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">MIN_UPLOAD_SIZE</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">&amp;&amp;</span><span style="color: #F8F8F2"> isLastChunk) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">break</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">final</span><span style="color: #F8F8F2"> response </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">await</span><span style="color: #F8F8F2"> stub.</span><span style="color: #50FA7B">uploadFileChunked</span><span style="color: #F8F8F2">(fileChunk);</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (response.status </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">UploadStatus</span><span style="color: #F8F8F2">.</span><span style="color: #8BE9FD; font-style: italic">UPLOAD_SUCCESS</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">        failedChunks.</span><span style="color: #50FA7B">add</span><span style="color: #F8F8F2">(i);</span></span>
<span class="line"><span style="color: #F8F8F2">        i </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> uploadedChunkSet.isEmpty </span><span style="color: #FF79C6">?</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">-</span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> uploadedChunkSet.last </span><span style="color: #FF79C6">-</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">      }</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (failedChunks.isNotEmpty) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #6272A4">// Handle failed chunks here, e.g. retrying or reporting the failure</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre><p>In this implementation, the <code>getUploadStatus</code> method retrieves the list of successfully uploaded chunk indexes for the file. The <code>chunkFile</code> method then checks if a chunk has already been successfully uploaded before sending it. If a chunk fails to upload, its index is added to a list of failed chunks, and the upload is resumed from the last successfully uploaded chunk by setting the loop variable <code>i</code> to the index of the last uploaded chunk minus 1.</p><p>After the upload is complete, you can handle the list of failed chunks by retrying them or reporting the failure to the user.
user: How would the backend golang grpc service look like for this
assistant: Here’s an example implementation of a gRPC service in Go for uploading a file to S3 in chunks with resume capability:</p><pre class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">package</span><span style="color: #F8F8F2"> fileupload</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">import</span><span style="color: #F8F8F2"> (</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">bytes</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">context</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">io</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">log</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">sync</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">github.com/aws/aws-sdk-go/aws</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">github.com/aws/aws-sdk-go/aws/session</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">github.com/aws/aws-sdk-go/service/s3</span><span style="color: #E9F284">&quot;</span></span>
<span class="line"><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">type</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD; font-style: italic">FileUploadService</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">struct</span><span style="color: #F8F8F2">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">func</span><span style="color: #F8F8F2"> (s </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2">FileUploadService) </span><span style="color: #50FA7B">UploadFileChunked</span><span style="color: #F8F8F2">(stream FileUploadService_UploadFileChunkedServer) </span><span style="color: #8BE9FD; font-style: italic">error</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">	ctx </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> stream.</span><span style="color: #8BE9FD">Context</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">	filename </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> </span><span style="color: #E9F284">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">for</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		fileChunk, err </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> stream.</span><span style="color: #8BE9FD">Recv</span><span style="color: #F8F8F2">()</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">==</span><span style="color: #F8F8F2"> io.EOF {</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #6272A4">// Upload completed successfully</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> stream.</span><span style="color: #8BE9FD">SendAndClose</span><span style="color: #F8F8F2">(</span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">FileUploadStatusResponse{</span></span>
<span class="line"><span style="color: #F8F8F2">				Status:       UploadStatus_UPLOAD_SUCCESS,</span></span>
<span class="line"><span style="color: #F8F8F2">				ChunkIndexes: []</span><span style="color: #8BE9FD; font-style: italic">int32</span><span style="color: #F8F8F2">{},</span></span>
<span class="line"><span style="color: #F8F8F2">			})</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> err</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Set filename on first chunk</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> filename </span><span style="color: #FF79C6">==</span><span style="color: #F8F8F2"> </span><span style="color: #E9F284">&quot;&quot;</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">			filename </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> fileChunk.Filename</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Upload chunk to S3</span></span>
<span class="line"><span style="color: #F8F8F2">		err </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD">uploadChunkToS3</span><span style="color: #F8F8F2">(fileChunk, filename)</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> err</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Send response with list of successfully uploaded chunk indexes</span></span>
<span class="line"><span style="color: #F8F8F2">		err </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> stream.</span><span style="color: #8BE9FD">Send</span><span style="color: #F8F8F2">(</span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">FileUploadStatusResponse{</span></span>
<span class="line"><span style="color: #F8F8F2">			Status:       UploadStatus_UPLOADING,</span></span>
<span class="line"><span style="color: #F8F8F2">			ChunkIndexes: []</span><span style="color: #8BE9FD; font-style: italic">int32</span><span style="color: #F8F8F2">{fileChunk.Index},</span></span>
<span class="line"><span style="color: #F8F8F2">		})</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> err</span></span>
<span class="line"><span style="color: #F8F8F2">		}</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">func</span><span style="color: #F8F8F2"> (s </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2">FileUploadService) </span><span style="color: #50FA7B">GetUploadStatus</span><span style="color: #F8F8F2">(ctx context.Context, req </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2">FileUploadStatusRequest) (</span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2">FileUploadStatusResponse, </span><span style="color: #8BE9FD; font-style: italic">error</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #6272A4">// Get list of successfully uploaded chunk indexes from S3 metadata</span></span>
<span class="line"><span style="color: #F8F8F2">	chunkIndexes, err </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> </span><span style="color: #8BE9FD">getUploadedChunkIndexesFromS3</span><span style="color: #F8F8F2">(req.Filename)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2">, err</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">FileUploadStatusResponse{</span></span>
<span class="line"><span style="color: #F8F8F2">		Status:       UploadStatus_UPLOADING,</span></span>
<span class="line"><span style="color: #F8F8F2">		ChunkIndexes: chunkIndexes,</span></span>
<span class="line"><span style="color: #F8F8F2">	}, </span><span style="color: #BD93F9">nil</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">func</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">uploadChunkToS3</span><span style="color: #F8F8F2">(chunk </span><span style="color: #FF79C6">*</span><span style="color: #F8F8F2">FileChunk, filename </span><span style="color: #8BE9FD; font-style: italic">string</span><span style="color: #F8F8F2">) </span><span style="color: #8BE9FD; font-style: italic">error</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">	sess, err </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> session.</span><span style="color: #8BE9FD">NewSession</span><span style="color: #F8F8F2">(</span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">aws.Config{</span></span>
<span class="line"><span style="color: #F8F8F2">		Region: aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">us-west-2</span><span style="color: #E9F284">&quot;</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">	})</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> err</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	s3Client </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> s3.</span><span style="color: #8BE9FD">New</span><span style="color: #F8F8F2">(sess)</span></span>
<span class="line"><span style="color: #F8F8F2">	params </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">s3.UploadPartInput{</span></span>
<span class="line"><span style="color: #F8F8F2">		Bucket:     aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">my-bucket</span><span style="color: #E9F284">&quot;</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">		Key:        aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(filename),</span></span>
<span class="line"><span style="color: #F8F8F2">		Body:       bytes.</span><span style="color: #8BE9FD">NewReader</span><span style="color: #F8F8F2">(chunk.Data),</span></span>
<span class="line"><span style="color: #F8F8F2">		PartNumber: aws.</span><span style="color: #8BE9FD">Int64</span><span style="color: #F8F8F2">(</span><span style="color: #8BE9FD">int64</span><span style="color: #F8F8F2">(chunk.Index) </span><span style="color: #FF79C6">+</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">1</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">		UploadId:   aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">my-upload-id</span><span style="color: #E9F284">&quot;</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	_, err </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> s3Client.</span><span style="color: #8BE9FD">UploadPart</span><span style="color: #F8F8F2">(params)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> err</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">func</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">getUploadedChunkIndexesFromS3</span><span style="color: #F8F8F2">(filename </span><span style="color: #8BE9FD; font-style: italic">string</span><span style="color: #F8F8F2">) ([]</span><span style="color: #8BE9FD; font-style: italic">int32</span><span style="color: #F8F8F2">, </span><span style="color: #8BE9FD; font-style: italic">error</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">	sess, err </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> session.</span><span style="color: #8BE9FD">NewSession</span><span style="color: #F8F8F2">(</span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">aws.Config{</span></span>
<span class="line"><span style="color: #F8F8F2">		Region: aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">us-west-2</span><span style="color: #E9F284">&quot;</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">	})</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2">, err</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	s3Client </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> s3.</span><span style="color: #8BE9FD">New</span><span style="color: #F8F8F2">(sess)</span></span>
<span class="line"><span style="color: #F8F8F2">	params </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">&amp;</span><span style="color: #F8F8F2">s3.ListPartsInput{</span></span>
<span class="line"><span style="color: #F8F8F2">		Bucket:   aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">my-bucket</span><span style="color: #E9F284">&quot;</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">		Key:      aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(filename),</span></span>
<span class="line"><span style="color: #F8F8F2">		UploadId: aws.</span><span style="color: #8BE9FD">String</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">&quot;</span><span style="color: #F1FA8C">my-upload-id</span><span style="color: #E9F284">&quot;</span><span style="color: #F8F8F2">),</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	resp, err </span><span style="color: #FF79C6">:=</span><span style="color: #F8F8F2"> s3Client.</span><span style="color: #8BE9FD">ListParts</span><span style="color: #F8F8F2">(params)</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> err </span><span style="color: #FF79C6">!=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Handle error</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">nil</span><span style="color: #F8F8F2">, err</span></span>
<span class="line"><span style="color: #F8F8F2">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">	chunkIndexes</span></span></code></pre></div></div></div><div class="mx-auto max-w-screen-lg px-3 py-6"></div>

    <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2023<!-- --> by <!-- -->wizlif<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://creativedesignsguru.com" target="_blank" rel="noopener noreferrer">CreativeDesignsGuru</a>.</div></div></div>

    
  </body>
</html>